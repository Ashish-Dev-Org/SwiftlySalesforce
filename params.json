{"name":"Swiftlysalesforce","tagline":"An easy-to-use framework for building native iOS apps with Swift and the Salesforce Platform","body":"# Swiftly Salesforce\r\n_Swiftly Salesforce_ is a framework for the rapid development of native iOS mobile apps that interact with the [Salesforce Platform](http://www.salesforce.com/platform/overview/).\r\n* Written entirely in [Swift](https://developer.apple.com/swift/), Apple's \"modern programming language that is safe, fast and interactive.\"\r\n* Enables elegant, painless coding for complex, asynchronous [Salesforce API][REST API] interactions\r\n* Manages the Salesforce [OAuth2] authorization process (a.k.a. the \"OAuth dance\") automatically and transparently\r\n* Simpler and lighter alternative to the Salesforce [Mobile SDK for iOS]\r\n* Easy to install and update\r\n\r\n## How do I set up Swiftly Salesforce?\r\nYou can be up and running in under 5 minutes by following these steps (if you're already familiar with the relevant procedure; if not, see the [appendix](#appendix)):\r\n\r\n1. [Get](https://developer.salesforce.com/signup) a free Salesforce Developer Edition\r\n1. Set up a Salesforce [Connected App] that will be the server to your iOS mobile app\r\n1. Register your Connected App's callback URL scheme with iOS ([see appendix](#appendix))\r\n1. Add _Swiftly Salesforce_ to your Xcode project; append `pod 'SwiftlySalesforce'` to your [CocoaPods](https://cocoapods.org/) Podfile, or just copy these [7 Swift files](https://github.com/mike4aday/SwiftlySalesforce/tree/master/Pod/Classes), and add the [dependent frameworks](#dependent-frameworks)\r\n1. Configure your app delegate for _Swiftly Salesforce_ ([see appendix](#appendix))\r\n1. Add an ATS exception for salesforce.com ([see appendix](#appendix)) \r\n\r\nMinimum requirements:\r\n* iOS 9.1\r\n* Swift 2\r\n* Xcode 7\r\n\r\n## How do I use Swiftly Salesforce?\r\n_Swiftly Salesforce_ leverages [Alamofire][Alamofire] and [PromiseKit][PromiseKit], two very widely-adopted frameworks, for elegant handling of networking requests and asynchronous operations. Below are some examples to illustrate how to use _Swiftly Salesforce_, and how you can chain complex asynchronous calls. You can also find a complete example app [here](https://github.com/mike4aday/SwiftlySalesforce/tree/master/Example/SwiftlySalesforce); it retrieves a user's task records from Salesforce, and enables the user to update the status of a task.\r\n\r\n_Swiftly Salesforce_ will automatically manage the entire Salesforce [OAuth2][OAuth2] process (a.k.a. the \"OAuth dance\"). If _Swiftly Salesforce_ has a valid access token, it will include that token in the header of every API request. If the token has expired, and Salesforce rejects the request, then _Swiftly Salesforce_ will attempt to refresh the access token, without bothering the user to re-enter the username and password. If _Swiftly Salesforce_ doesn't have a valid access token, or is unable to refresh it, then _Swiftly Salesforce_ will direct the user to the Salesforce-hosted login page.\r\n\r\n### Example: Retrieve a Salesforce Record\r\nThe following will retrieve all the fields for the specified account record:\r\n```swift\r\nSalesforceAPI.ReadRecord(type: \"Account\", id: \"0013000001FjCcF\").request()\r\n```\r\nTo specify which fields should be retrieved:\r\n```swift\r\nlet fields = [\"AccountNumber\", \"BillingCity\", \"MyCustomField__c\"]\r\nSalesforceAPI.ReadRecord(type: \"Account\", id: \"0013000001FjCcF\", fields: fields).request()\r\n```\r\nNote that `request()` is an asynchronous function, whose return value is a \"promise\" that will be fulfilled at some point in the future:\r\n```swift\r\nlet promise: Promise<AnyObject> = SalesforceAPI.ReadRecord(type: \"Account\", id: \"0013000001FjCcF\").request()\r\n```\r\nAnd we can add a closure that will be called later, when the promise is fulfilled:\r\n```swift\r\npromise.then {\r\n\t(json) -> () in\r\n\t// Parse the JSON and do stuff\r\n}\r\n```\r\n### Example: Update a Salesforce Record\r\n```swift\r\nSalesforceAPI.UpdateRecord(type: \"Task\", id: \"00T1500001h3V5NEAU\", fields: [\"Status\": \"Completed\"]).request()\r\n.then {\r\n\t(_) -> () in\r\n\t// Update the local model\r\n}.always {\r\n\t// Update the UI\r\n}\r\n```\r\nThe `always` closure will be called regardless of success or failure elsewhere in the promise chain.\r\n### Example: Querying\r\n```swift\r\nlet soql = \"SELECT Id,Name FROM Account WHERE BillingPostalCode = '\\(postalCode)'\"\r\nSalesforceAPI.Query(soql: soql).request()\r\n```\r\nSee the next example for handling the query results\r\n\r\n### Example: Chaining Asynchronous Requests\r\nLet's say we want to retrieve a random zip/postal code from a [custom Apex REST](https://developer.salesforce.com/page/Creating_REST_APIs_using_Apex_REST) resource, and then use that zip code in a query:\r\n```swift\r\n// Chained asynch requests \r\n// (Enclosing in \"firstly\" block is optional; just keeps things nicely laid out)\r\nfirstly {\r\n\t// Make GET request of custom Apex REST resource\r\n\tSalesforceAPI.ApexRest(method: \"GET\", path: \"/MyApexResourceThatEmitsRandomZip\").request()\r\n}.then {\r\n\t// Query accounts with that zip code\r\n\t(result) -> Promise<AnyObject> in\r\n\tguard let zip = result[\"zip\"] as? String else {\r\n\t\tthrow NSError(domain: \"TaskForce\", code: -100, userInfo: nil)\r\n\t}\r\n\tlet soql = \"SELECT Id,Name FROM Account WHERE BillingPostalCode = '\\(zip)'\"\r\n\treturn SalesforceAPI.Query(soql: soql).request()\r\n}.then {\r\n\t// Parse JSON response\r\n\t(result) -> () in\r\n\tguard let records = result[\"records\"] as? [[String: AnyObject]] else {\r\n\t\tthrow NSError(domain: \"TaskForce\", code: -101, userInfo: nil)\r\n\t}\r\n\tfor record in records {\r\n\t    if let id = record[\"Id\"] as? String, name = record[\"Name\"] as? String {\r\n\t        print(\"Account ID = \\(id); name = \\(name)\")\r\n        }\r\n    }\r\n}\r\n```\r\nYou could repeat this chaining multiple times, feeding the result of one asynchronous operation as the input to the next operation. Or you could spawn multiple, simultaneous operations and easily specify logic to be executed when all operations complete, when the first completes, when any fails, etc. PromiseKit is an amazingly-powerful framework for handling multiple asynchronous operations that would otherwise be very difficult to coordinate. See [PromiseKit documentation](http://promisekit.org) for more examples.\r\n\r\n### Example: Handling Errors\r\nThe following code is from the example file, [TaskStore.swift](https://github.com/mike4aday/SwiftlySalesforce/blob/master/Example/SwiftlySalesforce/TaskStore.swift) and shows how to handle errors:\r\n```swift\r\nfirstly {\r\n\tSalesforceAPI.Identity.request()\r\n}.then {\r\n\t// Extract user ID from JSON result\r\n\t(result) -> String in\r\n\tguard let userID = result[\"user_id\"] as? String else {\r\n\t\tthrow NSError(domain: \"TaskForce\", code: -100, userInfo: nil)\r\n\t}\r\n\treturn userID\r\n}.then {\r\n\t// Query tasks owned by user\r\n\t(userID) -> Promise<AnyObject> in\r\n\tlet soql = \"SELECT Id,Subject,Status,What.Name FROM Task WHERE OwnerId = '\\(userID)' ORDER BY CreatedDate DESC\"\r\n\treturn SalesforceAPI.Query(soql: soql).request()\r\n}.then {\r\n\t// Parse JSON response into Task instances\r\n\t(result) -> () in\r\n\tguard let records = result[\"records\"] as? [[String: AnyObject]] else {\r\n\t\tthrow NSError(domain: \"TaskForce\", code: -101, userInfo: nil)\r\n\t}\r\n\tlet tasks = records.map { Task(dictionary: $0) }\r\n\tself.cache = tasks\r\n\tfulfill(tasks)\r\n}.error {\r\n\t// Any errors in the chain would be caught here\r\n\t(error) -> Void in\r\n\treject(error)\r\n}\r\n```\r\nYou could also recover from an error, and continue with the chain, using a `recover` closure. The following snippet is from PromiseKit's [documentation](http://promisekit.org/recovering-from-errors):\r\n```swift\r\nCLLocationManager.promise().recover { err in\r\n    guard !err.fatal else { throw err }\r\n    return CLLocationChicago\r\n}.then { location in\r\n    // the userâ€™s location, or Chicago if an error occurred\r\n}.error { err in\r\n    // the error was fatal\r\n}\r\n```\r\n### Example: Log Out\r\nIf you want to log out the current Salesforce user, and then clear any locally-cached data, you could call the following. _Swiftly Salesforce_ will revoke and remove any stored credentials, and automatically display a Safari View Controller with the Salesforce login page, ready for another user to log in.\r\n```swift\r\n// Call this when \"Log Out\" button is tapped, for example\r\nif let app = UIApplication.sharedApplication().delegate as? LoginViewPresentable {\r\n\tapp.logOut().then {\r\n\t\t() -> () in\r\n\t\t// User's authorization now revoked - clear local data cache\r\n\t\treturn\r\n\t}\r\n}\r\n```\r\n## Dependent Frameworks\r\nThe great Swift frameworks leveraged by _Swiftly Salesforce_:\r\n* [PromiseKit](http://promisekit.org) (Version 3): \"Not just a promises implementation, it is also a collection of helper functions that make the typical asynchronous patterns we use as iOS developers delightful too.\"\r\n* [Alamofire] (Version 3): \"Elegant HTTP Networking in Swift\"\r\n* [Locksmith](https://github.com/matthewpalmer/Locksmith): \"A powerful, protocol-oriented library for working with the keychain in Swift.\"\r\n\r\n## Main Components of Swiftly Salesforce\r\n* [SalesforceAPI]: Acts as a '[router](https://littlebitesofcocoa.com/93-creating-a-router-for-alamofire)' for [Alamofire] requests. The more important, or commonly-used Salesforce [REST API] endpoints are represented as enum values, and I'll add more endpoints over time. You can also easily create [Alamofire] requests for your [custom Apex REST][Apex REST] endpoints, for example, by following the pattern established in this file.\r\n\r\n* [Credentials]: Swift struct that holds tokens, and other data, required for each request made to the Salesforce REST API. These values are stored securely in the iOS keychain.\r\n\r\n* [Extensions]: Swift extensions used by other components of _Swiftly Salesforce_. The extensions that you'll likely use in your own code are `NSDateFormatter.SalesforceDateTime`, and `NSDateFormatter.SalesforceDate`, for converting Salesforce date/time and date fields to and from strings for JSON serialization.\r\n\r\n* [OAuth2Manager]: Singleton that coordinates the OAuth2 authorization process, and securely stores and retrieves the resulting access token. The access token must be included in the header of every HTTP request to the Salesforce REST API. If the access token has expired, the OAuth2Manager will attempt to [refresh][OAuth2 refresh token flow] it. If the refresh process fails, then the OAuth2Manager will call on its delegate to authenticate the user, that is, to display a Salesforce-hosted form into which the user would enter his/her username and password. The default implementation uses a [Safari View Controller](https://developer.apple.com/videos/play/wwdc2015-504/) (new in iOS 9) to authenticate the user via the OAuth2 '[user-agent][OAuth2 user-agent flow]' flow. Though 'user-agent' flow is more complex than the OAuth2 '[username-password][OAuth2 username-password flow]' flow, it is the preferred method of authenticating users to Salesforce, since their passwords are never handled by the client application.\r\n\r\n## Resources\r\nIf you're new to Swift, the Salesforce Platform, or the Salesforce REST API, you might find the following resources useful.\r\n* [Salesforce REST API Developer's Guide][REST API]\r\n* [Salesforce App Cloud](http://www.salesforce.com/platform): aka the Salesforce Platform\r\n* [Salesforce Developers](https://developer.salesforce.com): official Salesforce developers' site; training, documentation, SDKs, etc.\r\n* [Salesforce Partner Community](https://partners.salesforce.com): \"Innovate, grow, connect\" with Salesforce ISVs. Join the [Salesforce + iOS Mobile][sfdc-ios Chatter] Chatter group\r\n* [Salesforce Mobile SDK for iOS][Mobile SDK for iOS]: 'official' SDK for developing mobile apps. Written in Objective-C. Available for [Android](https://github.com/forcedotcom/SalesforceMobileSDK-Android), too\r\n* [A Salesforce Swift App](http://www.mobileandemerging.technology/a-salesforce-mobile-app-with-swift/): blog post on using Swift with the Salesforce Mobile SDK. By [Jonathan Jenkins](http://www.mobileandemerging.technology/author/jonathan-jenkins/)\r\n* [Salesforce OAuth2 Made Easy For Native iOS Apps](https://developer.salesforce.com/blogs/developer-relations/2015/03/salesforce-oauth-made-easy-native-ios-apps.html): blog post by [Quinton Wall](http://twitter.com/quintonwall)\r\n* [When to Use the Salesforce1 Platform vs. Creating Custom Apps](https://help.salesforce.com/HTViewSolution?id=000192840&language=en_US)\r\n* [Alamofire]: Swift version of AFNetworking, \"...One of the most popular third-party libraries on iOS and OS X.\" Tutorial [here](http://www.raywenderlich.com/85080/beginning-alamofire-tutorial).\r\n* [Functional Swift](https://www.objc.io/books/functional-swift/): great book for learning Swift 2, by the team at [objc.io](http://objc.io). See their [other books](https://www.objc.io/books/) on Advanced Swift, and Core Data.\r\n* [iOS Apps with REST APIs](https://grokswift.com/bookshort/?utm_expid=86885646-0.pSwvTyVzSoG5VWML8NMtRw.1&utm_referrer=https%3A%2F%2Fgrokswift.com%2F): great book for getting started with Swift, REST APIs, JSON, and Alamofire. \"Only the nitty gritty that you need to get real work done now: interfacing with your web services and displaying the results in your UI.\" By Christina Moulton of [GrokSwift](https://twitter.com/GrokSwift) \r\n\r\n## About Me\r\nI'm a senior technical '[evangelist](https://en.wikipedia.org/wiki/Technology_evangelist)' at Salesforce, and I work with [ISV](https://en.wikipedia.org/wiki/Independent_software_vendor) partners who are building applications on the Salesforce Platform. \r\n\r\n## Contact\r\nQuestions, suggestions, bug reports and code contributions welcome:\r\n* Open a [GitHub issue](https://github.com/mike4aday/SwiftlySalesforce/issues)\r\n* Twitter [@mike4aday]\r\n* Join the Salesforce [Partner Community] and post to the '[Salesforce + iOS Mobile][sfdc-ios Chatter]' Chatter group\r\n\r\n## Appendix\r\n\r\n### Register Your Connected App's Callback URL Scheme with iOS\r\nUpon successful OAuth2 authorization, Salesforce will redirect the Safari View Controller back to the callback URL that you specified in your Connected App settings, and will append the access token (among other things) to that callback URL. Add the following to your app's .plist file, so iOS will know how to handle the URL, and will pass it to your app's delegate.\r\n```xml\r\n<!-- ADD TO YOUR APP'S .PLIST FILE -->\r\n<key>CFBundleURLTypes</key>\r\n<array>\r\n  <dict>\r\n    <key>CFBundleURLName</key>\r\n    <string>SalesforceOAuth2CallbackURLScheme</string>\r\n    <key>CFBundleURLSchemes</key>\r\n    <array>\r\n      <string><!-- YOUR CALLBACK URL'S SCHEME HERE (scheme only, not entire URL) --></string>\r\n    </array>\r\n  </dict>\r\n</array>\r\n```\r\nThen, you just need to add a single line in your app delegate class so that _Swiftly Salesforce_ will handle the callback URL and the appended credentials.\r\n```swift\r\nfunc application(application: UIApplication, openURL url: NSURL, sourceApplication: String?, annotation: AnyObject) -> Bool {\r\n\thandleRedirectURL(url)\r\n\treturn true\r\n}\r\n```\r\n\r\n### Configure your App Delegate for Swiftly Salesforce\r\nUpdate your app delegate class so that it:\r\n* Configures _Swiftly Salesforce_ with your Connected App's consumer key and callback URL\r\n* Implements `LoginViewPresentable` - you don't have to implement any methods, though, thanks to the magic of Swift 2's [protocol extensions](http://www.codingexplorer.com/protocol-extensions-in-swift-2/)\r\n* Calls `handleRedirectURL(NSURL:)` when asked by iOS to open the callback URL.\r\n\r\nSee below:\r\n```swift\r\nimport UIKit\r\nimport SwiftlySalesforce\r\n\r\n@UIApplicationMain\r\nclass AppDelegate: UIResponder, UIApplicationDelegate, LoginViewPresentable {\r\n\t\r\n\tvar window: UIWindow?\r\n\tlet consumerKey = \"<<YOUR CONNECTED APP'S CONSUMER KEY>>\"\r\n\tlet redirectURL = NSURL(string: \"<<YOUR CONNECTED APP'S CALLBACK URL>>\")!\r\n\t\r\n\tfunc application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool {\r\n\t\tOAuth2Manager.sharedInstance.configureWithConsumerKey(consumerKey, redirectURL: redirectURL)\r\n\t\tOAuth2Manager.sharedInstance.authenticationDelegate = self\r\n\t\treturn true\r\n\t}\r\n\t\r\n\tfunc application(application: UIApplication, openURL url: NSURL, sourceApplication: String?, annotation: AnyObject) -> Bool {\r\n\t\thandleRedirectURL(url)\r\n\t\treturn true\r\n\t}\r\n}\r\n```\r\n\r\n### Add an ATS Exception for Salefsorce\r\nAs of this writing, you need to add an [application transport security (ATS) exception](https://www.hackingwithswift.com/example-code/system/how-to-handle-the-https-requirements-in-ios-9-with-app-transport-security)  to your iOS application's .plist file to allow it to connect to salesforce.com, as follows:\r\n```xml\r\n<!-- ADD TO YOUR APP'S .PLIST FILE -->\r\n<key>NSAppTransportSecurity</key>\r\n<dict>\r\n\t<key>NSExceptionDomains</key>\r\n\t<dict>\r\n\t\t<key>salesforce.com</key>\r\n\t\t<dict>\r\n\t\t\t<key>NSExceptionRequiresForwardSecrecy</key>\r\n\t\t\t<false/>\r\n\t\t\t<key>NSIncludesSubdomains</key>\r\n\t\t\t<true/>\r\n\t\t</dict>\r\n\t</dict>\r\n</dict>\r\n```\r\n\r\n   [Alamofire]: <https://github.com/alamofire/alamofire>\r\n   [PromiseKit]: <https://github.com/mxcl/PromiseKit>\r\n   [OAuth2]: <https://developer.salesforce.com/page/Digging_Deeper_into_OAuth_2.0_on_Force.com>\r\n   [REST API]: <https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/>\r\n   [Swift 2]: <https://developer.apple.com/swift/>\r\n   [sfdc-ios Chatter]: <http://sfdc.co/sfdc-ios>\r\n   [@mike4aday]: <https://twitter.com/mike4aday>\r\n   [Connected App]: <https://help.salesforce.com/apex/HTViewHelpDoc?id=connected_app_overview.htm>\r\n   [Partner Community]: <https://p.force.com>\r\n   [Apex REST]: <https://developer.salesforce.com/page/Creating_REST_APIs_using_Apex_REST>\r\n   [OAuth2 user-agent flow]: <https://help.salesforce.com/apex/HTViewHelpDoc?id=remoteaccess_oauth_user_agent_flow.htm&language=en>\r\n   [OAuth2 username-password flow]: <https://help.salesforce.com/apex/HTViewHelpDoc?id=remoteaccess_oauth_username_password_flow.htm&language=en>\r\n   [OAuth2 refresh token flow]: <https://help.salesforce.com/apex/HTViewHelpDoc?id=remoteaccess_oauth_refresh_token_flow.htm&language=en_US>\r\n   [Example]: <https://github.com/mike4aday/SwiftlySalesforce/tree/master/Example/SwiftlySalesforce>\r\n   [Mobile SDK for iOS]: <https://github.com/forcedotcom/SalesforceMobileSDK-iOS>\r\n   \r\n   [SalesforceAPI]: <https://github.com/mike4aday/SwiftlySalesforce/blob/master/Pod/Classes/SalesforceAPI.swift>\r\n   [Credentials]: <https://github.com/mike4aday/SwiftlySalesforce/blob/master/Pod/Classes/Credentials.swift>\r\n   [Extensions]: <https://github.com/mike4aday/SwiftlySalesforce/blob/master/Pod/Classes/Extensions.swift>\r\n   [OAuth2Manager]: <https://github.com/mike4aday/SwiftlySalesforce/blob/master/Pod/Classes/OAuth2Manager.swift>\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}